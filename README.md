# 聊天室管理系统

一个基于Qt的多用户聊天室管理系统，支持多用户实时聊天、用户权限管理、消息过滤等功能。

## 主要功能

### 1. 多用户聊天
- 支持3个以上用户同时在线聊天
- 公开聊天和私聊功能
- 实时显示在线用户列表
- 用户上线/下线通知

### 2. 用户管理功能
- 用户注册和登录
- 用户权限管理（接收消息、发送消息、删除消息等）
- 用户状态管理（在线/离线）
- 密码修改功能

### 3. 消息管理
- 消息历史记录保存（默认3天）
- 消息撤销功能（用户可删除自己发送的消息）
- 敏感词自动过滤
- 消息时间戳显示

### 4. 敏感词过滤
- 内置常用敏感词库
- 支持自定义添加敏感词
- 自动替换敏感词为星号

### 5. 服务器功能
- 内置TCP服务器
- 支持启动/停止服务器
- 客户端自动重连机制
- 消息广播和转发

### 6. 其他功能
- 现代化Qt界面
- SQLite数据库存储
- 密码加密存储
- 用户设置管理

## 技术实现

### 使用的技术
- **Qt Framework**: 图形界面框架
- **Qt Network**: TCP网络通信
- **Qt SQL**: SQLite数据库操作
- **C++17**: 编程语言标准
- **多线程**: 服务器并发处理

### 核心模块
1. **Database**: 数据库管理（用户、消息、权限、敏感词）
2. **ChatServer**: TCP服务器，处理客户端连接和消息转发
3. **ChatClient**: TCP客户端，与服务器通信
4. **MessageFilter**: 消息过滤器，处理敏感词过滤
5. **UI模块**: 登录、主界面、用户管理、设置等界面

### 数据库设计
- **users表**: 存储用户信息（用户名、密码、邮箱、在线状态）
- **messages表**: 存储聊天消息（发送者、接收者、内容、时间戳）
- **user_permissions表**: 存储用户权限设置
- **sensitive_words表**: 存储敏感词列表

## 编译和运行

### 前提条件
- Qt 5.12+ 或 Qt 6.x
- CMake 3.16+
- C++17支持的编译器
- SQLite（Qt SQL模块自带）

### 安装依赖（macOS）
```bash
# 安装Qt和CMake
brew install qt cmake
```

### 编译步骤
1. 确保已安装Qt开发环境和CMake
2. 克隆或下载项目代码
3. 打开终端，进入项目目录
4. 运行构建脚本：
   ```bash
   ./build_cmake.sh
   ```
   
   或者手动构建：
   ```bash
   mkdir -p build
   cd build
   cmake .. -DCMAKE_BUILD_TYPE=Release
   cmake --build . --config Release -j4
   ```

5. 运行程序：
   ```bash
   # macOS
   ./run.sh
   # 或直接运行
   open build/bin/ChatRoom.app
   
   # Linux/Windows
   ./build/bin/ChatRoom  # 或 ./build/ChatRoom
   ```

### 使用方法
1. 首次运行时注册新用户
2. 登录后如果提示连接服务器失败，点击"服务器"菜单启动服务器
3. 多个用户可以同时登录（需要分别启动程序）
4. 在聊天界面发送消息，支持选择接收者（所有人或特定用户）
5. 通过"用户管理"设置个人权限和敏感词
6. 通过"个人设置"修改密码等配置

## 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   LoginWindow   │    │   MainWindow    │    │  UserManager    │
│     登录界面      │    │     主界面       │    │    用户管理      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   ChatClient    │
                    │    聊天客户端     │
                    └─────────────────┘
                                 │
                         Network (TCP)
                                 │
                    ┌─────────────────┐
                    │   ChatServer    │
                    │    聊天服务器     │
                    └─────────────────┘
                                 │
                    ┌─────────────────┐
                    │    Database     │
                    │   SQLite数据库   │
                    └─────────────────┘
```

## 特色功能

1. **一体化设计**: 客户端和服务器集成在同一个程序中
2. **权限控制**: 细粒度的用户权限管理
3. **消息过滤**: 智能敏感词检测和替换
4. **数据持久化**: 聊天记录和用户数据自动保存
5. **用户友好**: 直观的图形界面，易于使用
6. **扩展性强**: 模块化设计，便于功能扩展

## 注意事项

1. 首次使用需要先启动服务器功能
2. 数据库文件会自动创建在用户数据目录
3. 默认服务器端口为12345，确保端口未被占用
4. 支持同一台机器多用户登录测试
5. 消息历史默认保存3天，可在设置中修改

## 待扩展功能

- 文件传输功能
- 群组聊天
- 消息加密
- 表情符号支持
- 聊天记录导出
- 网络穿透支持
